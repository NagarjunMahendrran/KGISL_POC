/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Injectable, NgZone, Optional } from '@angular/core';
import { MatDialog } from '@angular/material/dialog';
import { Subject } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/dialog";
/** @type {?} */
var diractionMap = { left: 'left', right: 'left', top: 'top', bottom: 'top' };
/** @type {?} */
var multyMap = { left: 1, right: -1, top: 1, bottom: -1 };
/**
 * @record
 */
export function AnimationOption() { }
if (false) {
    /** @type {?|undefined} */
    AnimationOption.prototype.keyframes;
    /** @type {?} */
    AnimationOption.prototype.keyframeAnimationOptions;
}
/**
 * @record
 */
export function MatDialogConfig() { }
if (false) {
    /** @type {?|undefined} */
    MatDialogConfig.prototype.title;
    /** @type {?|undefined} */
    MatDialogConfig.prototype.animation;
    /** @type {?|undefined} */
    MatDialogConfig.prototype.position;
}
var NgDialogAnimationService = /** @class */ (function () {
    function NgDialogAnimationService(dialog, ngZone, incomingOptions, outgoingOptions) {
        this.dialog = dialog;
        this.ngZone = ngZone;
        this.incomingOptions = incomingOptions;
        this.outgoingOptions = outgoingOptions;
    }
    /**
     * @template T, D, R
     * @param {?} componentOrTemplateRef
     * @param {?=} config
     * @return {?}
     */
    NgDialogAnimationService.prototype.open = /**
     * @template T, D, R
     * @param {?} componentOrTemplateRef
     * @param {?=} config
     * @return {?}
     */
    function (componentOrTemplateRef, config) {
        var _this = this;
        /** @type {?} */
        var dir = config.direction || (document.querySelectorAll('[dir="rtl"]').length ? 'rtl' : 'ltr');
        config.direction = config.direction || dir;
        if (config.animation) {
            if (config.animation.to === 'aside') {
                config.animation.to = dir === 'rtl' ? 'left' : 'right';
            }
        }
        if (config.position && config.position.rowEnd) {
            if (dir === 'rtl') {
                config.position.right = config.position.rowEnd;
            }
            else {
                config.position.left = config.position.rowEnd;
            }
        }
        if (config.position && config.position.rowStart) {
            if (dir === 'rtl') {
                config.position.left = config.position.rowStart;
            }
            else {
                config.position.right = config.position.rowStart;
            }
        }
        /** @type {?} */
        var ref = this.dialog.open(componentOrTemplateRef, config);
        /** @type {?} */
        var container = (/** @type {?} */ (document.getElementsByTagName('mat-dialog-container')[0]));
        if (config.title) {
            /** @type {?} */
            var el = document.createElement('span');
            el.textContent = config.title;
            el.className = 'dialogTitle';
            /** @type {?} */
            var elClose = document.createElement('span');
            elClose.textContent = 'X';
            elClose.className = 'dialogClose';
            elClose.addEventListener('click', (/**
             * @return {?}
             */
            function () {
                ref.close();
            }));
            /** @type {?} */
            var titleContainer = document.createElement('div');
            titleContainer.className = 'titleContainer';
            titleContainer.append(el);
            titleContainer.append(elClose);
            container.prepend(titleContainer);
        }
        if (config.animation) {
            /** @type {?} */
            var incomingOptions = config.animation.incomingOptions ||
                this.incomingOptions || { keyframeAnimationOptions: { duration: 600, easing: 'ease-in' } };
            /** @type {?} */
            var outgoingOptions_1 = config.animation.outgoingOptions ||
                this.outgoingOptions || { keyframeAnimationOptions: { duration: 600, easing: 'ease-out' } };
            /** @type {?} */
            var wrapper_1 = document.getElementsByClassName('cdk-global-overlay-wrapper')[0];
            /** @type {?} */
            var animate_1 = (/**
             * @param {?} keyframes
             * @param {?} options
             * @return {?}
             */
            function (keyframes, options) {
                return wrapper_1.animate(keyframes, options);
            });
            /** @type {?} */
            var _afterClosed_1 = new Subject();
            ref.afterClosed = (/**
             * @return {?}
             */
            function () {
                return _afterClosed_1.asObservable();
            });
            /** @type {?} */
            var closeFunction_1 = ref.close;
            /** @type {?} */
            var incomeKeyFrames = incomingOptions.keyframes;
            /** @type {?} */
            var outgoingKeyFrames_1 = outgoingOptions_1.keyframes;
            if (config.animation.to) {
                /** @type {?} */
                var to = diractionMap[config.animation.to];
                /** @type {?} */
                var keyFrame100 = {};
                /** @type {?} */
                var keyFrame0 = {};
                keyFrame0[to] = 0;
                keyFrame100[to] =
                    to === 'top' || to === 'bottom'
                        ? container.clientHeight * multyMap[config.animation.to] + 'px'
                        : container.clientWidth * multyMap[config.animation.to] + 'px';
                incomeKeyFrames = incomeKeyFrames || [keyFrame100, keyFrame0];
                outgoingKeyFrames_1 = outgoingKeyFrames_1 || [keyFrame0, keyFrame100];
            }
            animate_1(incomeKeyFrames, incomingOptions.keyframeAnimationOptions);
            /** @type {?} */
            var closeHandler_1 = (/**
             * @param {?=} dialogResult
             * @return {?}
             */
            function (dialogResult) {
                _afterClosed_1.next(dialogResult);
                /** @type {?} */
                var animation = animate_1(outgoingKeyFrames_1, outgoingOptions_1.keyframeAnimationOptions);
                animation.onfinish = (/**
                 * @return {?}
                 */
                function () {
                    ((/** @type {?} */ (wrapper_1))).style.display = 'none';
                    _this.ngZone.run((/**
                     * @return {?}
                     */
                    function () { return ref.close(dialogResult); }));
                });
                ref.close = closeFunction_1;
            });
            ref.close = (/**
             * @param {?=} dialogResult
             * @return {?}
             */
            function (dialogResult) { return closeHandler_1(dialogResult); });
        }
        return ref;
    };
    NgDialogAnimationService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root',
                },] }
    ];
    /** @nocollapse */
    NgDialogAnimationService.ctorParameters = function () { return [
        { type: MatDialog },
        { type: NgZone },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: ['INCOMING_OPTION',] }] },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: ['OUTGOING_OPTION',] }] }
    ]; };
    /** @nocollapse */ NgDialogAnimationService.ɵprov = i0.ɵɵdefineInjectable({ factory: function NgDialogAnimationService_Factory() { return new NgDialogAnimationService(i0.ɵɵinject(i1.MatDialog), i0.ɵɵinject(i0.NgZone), i0.ɵɵinject("INCOMING_OPTION", 8), i0.ɵɵinject("OUTGOING_OPTION", 8)); }, token: NgDialogAnimationService, providedIn: "root" });
    return NgDialogAnimationService;
}());
export { NgDialogAnimationService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgDialogAnimationService.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    NgDialogAnimationService.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    NgDialogAnimationService.prototype.incomingOptions;
    /**
     * @type {?}
     * @private
     */
    NgDialogAnimationService.prototype.outgoingOptions;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctZGlhbG9nLWFuaW1hdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctZGlhbG9nLWFuaW1hdGlvbi8iLCJzb3VyY2VzIjpbImxpYi9uZy1kaWFsb2ctYW5pbWF0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQWUsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFrQixTQUFTLEVBQXFELE1BQU0sMEJBQTBCLENBQUM7QUFFeEgsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQzs7OztJQUV6QixZQUFZLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFOztJQUN6RSxRQUFRLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBRTs7OztBQUUzRCxxQ0FHQzs7O0lBRkcsb0NBQXVCOztJQUN2QixtREFBbUQ7Ozs7O0FBR3ZELHFDQWNDOzs7SUFiRyxnQ0FBZTs7SUFDZixvQ0FVUTs7SUFDUixtQ0FBbUU7O0FBR3ZFO0lBSUksa0NBQ1ksTUFBaUIsRUFDakIsTUFBYyxFQUdkLGVBQWlDLEVBR2pDLGVBQWlDO1FBUGpDLFdBQU0sR0FBTixNQUFNLENBQVc7UUFDakIsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUdkLG9CQUFlLEdBQWYsZUFBZSxDQUFrQjtRQUdqQyxvQkFBZSxHQUFmLGVBQWUsQ0FBa0I7SUFDMUMsQ0FBQzs7Ozs7OztJQUVKLHVDQUFJOzs7Ozs7SUFBSixVQUNJLHNCQUF5RCxFQUN6RCxNQUF3QjtRQUY1QixpQkFnR0M7O1lBNUZTLEdBQUcsR0FDTCxNQUFN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SEM7U0E3R1ksd0JBQXdCOzs7Ozs7SUFFN0IsMENBQXlCOzs7OztJQUN6QiwwQ0FBc0I7Ozs7O0lBQ3RCLG1EQUV5Qzs7Ozs7SUFDekMsbURBRXlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBOZ1pvbmUsIE9wdGlvbmFsLCBUZW1wbGF0ZVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEaWFsb2dQb3NpdGlvbiwgTWF0RGlhbG9nLCBNYXREaWFsb2dDb25maWcgYXMgX01hdERpYWxvZ0NvbmZpZywgTWF0RGlhbG9nUmVmIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcclxuaW1wb3J0IHsgQ29tcG9uZW50VHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wb3J0YWwnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcblxyXG5jb25zdCBkaXJhY3Rpb25NYXAgPSB7IGxlZnQ6ICdsZWZ0JywgcmlnaHQ6ICdsZWZ0JywgdG9wOiAndG9wJywgYm90dG9tOiAndG9wJyB9O1xyXG5jb25zdCBtdWx0eU1hcCA9IHsgbGVmdDogMSwgcmlnaHQ6IC0xLCB0b3A6IDEsIGJvdHRvbTogLTEgfTtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQW5pbWF0aW9uT3B0aW9uIHtcclxuICAgIGtleWZyYW1lcz86IEtleWZyYW1lW107XHJcbiAgICBrZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnM6IEtleWZyYW1lQW5pbWF0aW9uT3B0aW9ucztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBNYXREaWFsb2dDb25maWcgZXh0ZW5kcyBfTWF0RGlhbG9nQ29uZmlnIHtcclxuICAgIHRpdGxlPzogc3RyaW5nO1xyXG4gICAgYW5pbWF0aW9uPzpcclxuICAgICAgICB8IHtcclxuICAgICAgICAgICAgICB0bzogJ2FzaWRlJyB8ICd0b3AnIHwgJ2JvdHRvbScgfCAnbGVmdCcgfCAncmlnaHQnO1xyXG4gICAgICAgICAgICAgIGluY29taW5nT3B0aW9ucz86IHsga2V5ZnJhbWVzPzogS2V5ZnJhbWVbXTsga2V5ZnJhbWVBbmltYXRpb25PcHRpb25zOiBLZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnMgfTtcclxuICAgICAgICAgICAgICBvdXRnb2luZ09wdGlvbnM/OiB7IGtleWZyYW1lcz86IEtleWZyYW1lW107IGtleWZyYW1lQW5pbWF0aW9uT3B0aW9uczogS2V5ZnJhbWVBbmltYXRpb25PcHRpb25zIH07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfCB7XHJcbiAgICAgICAgICAgICAgdG8/OiAnYXNpZGUnIHwgJ3RvcCcgfCAnYm90dG9tJyB8ICdsZWZ0JyB8ICdyaWdodCc7XHJcbiAgICAgICAgICAgICAgaW5jb21pbmdPcHRpb25zPzogeyBrZXlmcmFtZXM6IEtleWZyYW1lW107IGtleWZyYW1lQW5pbWF0aW9uT3B0aW9uczogS2V5ZnJhbWVBbmltYXRpb25PcHRpb25zIH07XHJcbiAgICAgICAgICAgICAgb3V0Z29pbmdPcHRpb25zPzogeyBrZXlmcmFtZXM6IEtleWZyYW1lW107IGtleWZyYW1lQW5pbWF0aW9uT3B0aW9uczogS2V5ZnJhbWVBbmltYXRpb25PcHRpb25zIH07XHJcbiAgICAgICAgICB9O1xyXG4gICAgcG9zaXRpb24/OiBEaWFsb2dQb3NpdGlvbiAmIHsgcm93U3RhcnQ/OiBzdHJpbmc7IHJvd0VuZD86IHN0cmluZyB9O1xyXG59XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgICBwcm92aWRlZEluOiAncm9vdCcsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBOZ0RpYWxvZ0FuaW1hdGlvblNlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBkaWFsb2c6IE1hdERpYWxvZyxcclxuICAgICAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxyXG4gICAgICAgIEBPcHRpb25hbCgpXHJcbiAgICAgICAgQEluamVjdCgnSU5DT01JTkdfT1BUSU9OJylcclxuICAgICAgICBwcml2YXRlIGluY29taW5nT3B0aW9ucz86IEFuaW1hdGlvbk9wdGlvbixcclxuICAgICAgICBAT3B0aW9uYWwoKVxyXG4gICAgICAgIEBJbmplY3QoJ09VVEdPSU5HX09QVElPTicpXHJcbiAgICAgICAgcHJpdmF0ZSBvdXRnb2luZ09wdGlvbnM/OiBBbmltYXRpb25PcHRpb24sXHJcbiAgICApIHt9XHJcblxyXG4gICAgb3BlbjxULCBEID0gYW55LCBSID0gYW55PihcclxuICAgICAgICBjb21wb25lbnRPclRlbXBsYXRlUmVmOiBDb21wb25lbnRUeXBlPFQ+IHwgVGVtcGxhdGVSZWY8VD4sXHJcbiAgICAgICAgY29uZmlnPzogTWF0RGlhbG9nQ29uZmlnLFxyXG4gICAgKTogTWF0RGlhbG9nUmVmPFQsIFI+IHtcclxuICAgICAgICBjb25zdCBkaXI6ICdsdHInIHwgJ3J0bCcgPVxyXG4gICAgICAgICAgICBjb25maWcuZGlyZWN0aW9uIHx8IChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGlyPVwicnRsXCJdJykubGVuZ3RoID8gJ3J0bCcgOiAnbHRyJyk7XHJcbiAgICAgICAgY29uZmlnLmRpcmVjdGlvbiA9IGNvbmZpZy5kaXJlY3Rpb24gfHwgZGlyO1xyXG4gICAgICAgIGlmIChjb25maWcuYW5pbWF0aW9uKSB7XHJcbiAgICAgICAgICAgIGlmIChjb25maWcuYW5pbWF0aW9uLnRvID09PSAnYXNpZGUnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuYW5pbWF0aW9uLnRvID0gZGlyID09PSAncnRsJyA/ICdsZWZ0JyA6ICdyaWdodCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjb25maWcucG9zaXRpb24gJiYgY29uZmlnLnBvc2l0aW9uLnJvd0VuZCkge1xyXG4gICAgICAgICAgaWYgKGRpciA9PT0gJ3J0bCcpIHtcclxuICAgICAgICAgICAgY29uZmlnLnBvc2l0aW9uLnJpZ2h0ID0gY29uZmlnLnBvc2l0aW9uLnJvd0VuZDtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbmZpZy5wb3NpdGlvbi5sZWZ0ID0gY29uZmlnLnBvc2l0aW9uLnJvd0VuZDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjb25maWcucG9zaXRpb24gJiYgY29uZmlnLnBvc2l0aW9uLnJvd1N0YXJ0KSB7XHJcbiAgICAgICAgICBpZiAoZGlyID09PSAncnRsJykge1xyXG4gICAgICAgICAgICBjb25maWcucG9zaXRpb24ubGVmdCA9IGNvbmZpZy5wb3NpdGlvbi5yb3dTdGFydDtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbmZpZy5wb3NpdGlvbi5yaWdodCA9IGNvbmZpZy5wb3NpdGlvbi5yb3dTdGFydDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJlZiA9IHRoaXMuZGlhbG9nLm9wZW4oY29tcG9uZW50T3JUZW1wbGF0ZVJlZiwgY29uZmlnKTtcclxuICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbWF0LWRpYWxvZy1jb250YWluZXInKVswXSBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICBpZiAoY29uZmlnLnRpdGxlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgICAgICBlbC50ZXh0Q29udGVudCA9IGNvbmZpZy50aXRsZTtcclxuICAgICAgICAgICAgZWwuY2xhc3NOYW1lID0gJ2RpYWxvZ1RpdGxlJztcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGVsQ2xvc2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgICAgIGVsQ2xvc2UudGV4dENvbnRlbnQgPSAnWCc7XHJcbiAgICAgICAgICAgIGVsQ2xvc2UuY2xhc3NOYW1lID0gJ2RpYWxvZ0Nsb3NlJztcclxuICAgICAgICAgICAgZWxDbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIHRpdGxlQ29udGFpbmVyLmNsYXNzTmFtZSA9ICd0aXRsZUNvbnRhaW5lcic7XHJcbiAgICAgICAgICAgIHRpdGxlQ29udGFpbmVyLmFwcGVuZChlbCk7XHJcbiAgICAgICAgICAgIHRpdGxlQ29udGFpbmVyLmFwcGVuZChlbENsb3NlKTtcclxuICAgICAgICAgICAgY29udGFpbmVyLnByZXBlbmQodGl0bGVDb250YWluZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNvbmZpZy5hbmltYXRpb24pIHtcclxuICAgICAgICAgICAgY29uc3QgaW5jb21pbmdPcHRpb25zOiBBbmltYXRpb25PcHRpb24gPSBjb25maWcuYW5pbWF0aW9uLmluY29taW5nT3B0aW9ucyB8fFxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbmNvbWluZ09wdGlvbnMgfHwgeyBrZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnM6IHsgZHVyYXRpb246IDYwMCwgZWFzaW5nOiAnZWFzZS1pbicgfSB9O1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgb3V0Z29pbmdPcHRpb25zOiBBbmltYXRpb25PcHRpb24gPSBjb25maWcuYW5pbWF0aW9uLm91dGdvaW5nT3B0aW9ucyB8fFxyXG4gICAgICAgICAgICAgICAgdGhpcy5vdXRnb2luZ09wdGlvbnMgfHwgeyBrZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnM6IHsgZHVyYXRpb246IDYwMCwgZWFzaW5nOiAnZWFzZS1vdXQnIH0gfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjZGstZ2xvYmFsLW92ZXJsYXktd3JhcHBlcicpWzBdO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgYW5pbWF0ZSA9IChrZXlmcmFtZXMsIG9wdGlvbnMpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB3cmFwcGVyLmFuaW1hdGUoa2V5ZnJhbWVzLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY29uc3QgX2FmdGVyQ2xvc2VkID0gbmV3IFN1YmplY3QoKTtcclxuICAgICAgICAgICAgcmVmLmFmdGVyQ2xvc2VkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9hZnRlckNsb3NlZC5hc09ic2VydmFibGUoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY29uc3QgY2xvc2VGdW5jdGlvbiA9IHJlZi5jbG9zZTtcclxuXHJcbiAgICAgICAgICAgIGxldCBpbmNvbWVLZXlGcmFtZXMgPSBpbmNvbWluZ09wdGlvbnMua2V5ZnJhbWVzO1xyXG4gICAgICAgICAgICBsZXQgb3V0Z29pbmdLZXlGcmFtZXMgPSBvdXRnb2luZ09wdGlvbnMua2V5ZnJhbWVzO1xyXG4gICAgICAgICAgICBpZiAoY29uZmlnLmFuaW1hdGlvbi50bykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdG8gPSBkaXJhY3Rpb25NYXBbY29uZmlnLmFuaW1hdGlvbi50b107XHJcbiAgICAgICAgICAgICAgICBjb25zdCBrZXlGcmFtZTEwMCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgY29uc3Qga2V5RnJhbWUwID0ge307XHJcbiAgICAgICAgICAgICAgICBrZXlGcmFtZTBbdG9dID0gMDtcclxuICAgICAgICAgICAgICAgIGtleUZyYW1lMTAwW3RvXSA9XHJcbiAgICAgICAgICAgICAgICAgICAgdG8gPT09ICd0b3AnIHx8IHRvID09PSAnYm90dG9tJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGNvbnRhaW5lci5jbGllbnRIZWlnaHQgKiBtdWx0eU1hcFtjb25maWcuYW5pbWF0aW9uLnRvXSArICdweCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgOiBjb250YWluZXIuY2xpZW50V2lkdGggKiBtdWx0eU1hcFtjb25maWcuYW5pbWF0aW9uLnRvXSArICdweCc7XHJcbiAgICAgICAgICAgICAgICBpbmNvbWVLZXlGcmFtZXMgPSBpbmNvbWVLZXlGcmFtZXMgfHwgW2tleUZyYW1lMTAwLCBrZXlGcmFtZTBdO1xyXG4gICAgICAgICAgICAgICAgb3V0Z29pbmdLZXlGcmFtZXMgPSBvdXRnb2luZ0tleUZyYW1lcyB8fCBba2V5RnJhbWUwLCBrZXlGcmFtZTEwMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYW5pbWF0ZShpbmNvbWVLZXlGcmFtZXMsIGluY29taW5nT3B0aW9ucy5rZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnMpO1xyXG4gICAgICAgICAgICBjb25zdCBjbG9zZUhhbmRsZXIgPSAoZGlhbG9nUmVzdWx0PzogUikgPT4ge1xyXG4gICAgICAgICAgICAgICAgX2FmdGVyQ2xvc2VkLm5leHQoZGlhbG9nUmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFuaW1hdGlvbiA9IGFuaW1hdGUob3V0Z29pbmdLZXlGcmFtZXMsIG91dGdvaW5nT3B0aW9ucy5rZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uLm9uZmluaXNoID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICh3cmFwcGVyIGFzIEhUTUxFbGVtZW50KS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiByZWYuY2xvc2UoZGlhbG9nUmVzdWx0KSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgcmVmLmNsb3NlID0gY2xvc2VGdW5jdGlvbjtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmVmLmNsb3NlID0gKGRpYWxvZ1Jlc3VsdD86IFIpID0+IGNsb3NlSGFuZGxlcihkaWFsb2dSZXN1bHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlZjtcclxuICAgIH1cclxufVxyXG4iXX0=