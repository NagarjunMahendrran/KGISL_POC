/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Injectable, NgZone, Optional } from '@angular/core';
import { MatDialog } from '@angular/material/dialog';
import { Subject } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/dialog";
/** @type {?} */
const diractionMap = { left: 'left', right: 'left', top: 'top', bottom: 'top' };
/** @type {?} */
const multyMap = { left: 1, right: -1, top: 1, bottom: -1 };
/**
 * @record
 */
export function AnimationOption() { }
if (false) {
    /** @type {?|undefined} */
    AnimationOption.prototype.keyframes;
    /** @type {?} */
    AnimationOption.prototype.keyframeAnimationOptions;
}
/**
 * @record
 */
export function MatDialogConfig() { }
if (false) {
    /** @type {?|undefined} */
    MatDialogConfig.prototype.title;
    /** @type {?|undefined} */
    MatDialogConfig.prototype.animation;
    /** @type {?|undefined} */
    MatDialogConfig.prototype.position;
}
export class NgDialogAnimationService {
    /**
     * @param {?} dialog
     * @param {?} ngZone
     * @param {?=} incomingOptions
     * @param {?=} outgoingOptions
     */
    constructor(dialog, ngZone, incomingOptions, outgoingOptions) {
        this.dialog = dialog;
        this.ngZone = ngZone;
        this.incomingOptions = incomingOptions;
        this.outgoingOptions = outgoingOptions;
    }
    /**
     * @template T, D, R
     * @param {?} componentOrTemplateRef
     * @param {?=} config
     * @return {?}
     */
    open(componentOrTemplateRef, config) {
        /** @type {?} */
        const dir = config.direction || (document.querySelectorAll('[dir="rtl"]').length ? 'rtl' : 'ltr');
        config.direction = config.direction || dir;
        if (config.animation) {
            if (config.animation.to === 'aside') {
                config.animation.to = dir === 'rtl' ? 'left' : 'right';
            }
        }
        if (config.position && config.position.rowEnd) {
            if (dir === 'rtl') {
                config.position.right = config.position.rowEnd;
            }
            else {
                config.position.left = config.position.rowEnd;
            }
        }
        if (config.position && config.position.rowStart) {
            if (dir === 'rtl') {
                config.position.left = config.position.rowStart;
            }
            else {
                config.position.right = config.position.rowStart;
            }
        }
        /** @type {?} */
        const ref = this.dialog.open(componentOrTemplateRef, config);
        /** @type {?} */
        const container = (/** @type {?} */ (document.getElementsByTagName('mat-dialog-container')[0]));
        if (config.title) {
            /** @type {?} */
            const el = document.createElement('span');
            el.textContent = config.title;
            el.className = 'dialogTitle';
            /** @type {?} */
            const elClose = document.createElement('span');
            elClose.textContent = 'X';
            elClose.className = 'dialogClose';
            elClose.addEventListener('click', (/**
             * @return {?}
             */
            () => {
                ref.close();
            }));
            /** @type {?} */
            const titleContainer = document.createElement('div');
            titleContainer.className = 'titleContainer';
            titleContainer.append(el);
            titleContainer.append(elClose);
            container.prepend(titleContainer);
        }
        if (config.animation) {
            /** @type {?} */
            const incomingOptions = config.animation.incomingOptions ||
                this.incomingOptions || { keyframeAnimationOptions: { duration: 600, easing: 'ease-in' } };
            /** @type {?} */
            const outgoingOptions = config.animation.outgoingOptions ||
                this.outgoingOptions || { keyframeAnimationOptions: { duration: 600, easing: 'ease-out' } };
            /** @type {?} */
            const wrapper = document.getElementsByClassName('cdk-global-overlay-wrapper')[0];
            /** @type {?} */
            const animate = (/**
             * @param {?} keyframes
             * @param {?} options
             * @return {?}
             */
            (keyframes, options) => {
                return wrapper.animate(keyframes, options);
            });
            /** @type {?} */
            const _afterClosed = new Subject();
            ref.afterClosed = (/**
             * @return {?}
             */
            () => {
                return _afterClosed.asObservable();
            });
            /** @type {?} */
            const closeFunction = ref.close;
            /** @type {?} */
            let incomeKeyFrames = incomingOptions.keyframes;
            /** @type {?} */
            let outgoingKeyFrames = outgoingOptions.keyframes;
            if (config.animation.to) {
                /** @type {?} */
                const to = diractionMap[config.animation.to];
                /** @type {?} */
                const keyFrame100 = {};
                /** @type {?} */
                const keyFrame0 = {};
                keyFrame0[to] = 0;
                keyFrame100[to] =
                    to === 'top' || to === 'bottom'
                        ? container.clientHeight * multyMap[config.animation.to] + 'px'
                        : container.clientWidth * multyMap[config.animation.to] + 'px';
                incomeKeyFrames = incomeKeyFrames || [keyFrame100, keyFrame0];
                outgoingKeyFrames = outgoingKeyFrames || [keyFrame0, keyFrame100];
            }
            animate(incomeKeyFrames, incomingOptions.keyframeAnimationOptions);
            /** @type {?} */
            const closeHandler = (/**
             * @param {?=} dialogResult
             * @return {?}
             */
            (dialogResult) => {
                _afterClosed.next(dialogResult);
                /** @type {?} */
                const animation = animate(outgoingKeyFrames, outgoingOptions.keyframeAnimationOptions);
                animation.onfinish = (/**
                 * @return {?}
                 */
                () => {
                    ((/** @type {?} */ (wrapper))).style.display = 'none';
                    this.ngZone.run((/**
                     * @return {?}
                     */
                    () => ref.close(dialogResult)));
                });
                ref.close = closeFunction;
            });
            ref.close = (/**
             * @param {?=} dialogResult
             * @return {?}
             */
            (dialogResult) => closeHandler(dialogResult));
        }
        return ref;
    }
}
NgDialogAnimationService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] }
];
/** @nocollapse */
NgDialogAnimationService.ctorParameters = () => [
    { type: MatDialog },
    { type: NgZone },
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: ['INCOMING_OPTION',] }] },
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: ['OUTGOING_OPTION',] }] }
];
/** @nocollapse */ NgDialogAnimationService.ɵprov = i0.ɵɵdefineInjectable({ factory: function NgDialogAnimationService_Factory() { return new NgDialogAnimationService(i0.ɵɵinject(i1.MatDialog), i0.ɵɵinject(i0.NgZone), i0.ɵɵinject("INCOMING_OPTION", 8), i0.ɵɵinject("OUTGOING_OPTION", 8)); }, token: NgDialogAnimationService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgDialogAnimationService.prototype.dialog;
    /**
     * @type {?}
     * @private
     */
    NgDialogAnimationService.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    NgDialogAnimationService.prototype.incomingOptions;
    /**
     * @type {?}
     * @private
     */
    NgDialogAnimationService.prototype.outgoingOptions;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctZGlhbG9nLWFuaW1hdGlvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctZGlhbG9nLWFuaW1hdGlvbi8iLCJzb3VyY2VzIjpbImxpYi9uZy1kaWFsb2ctYW5pbWF0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQWUsTUFBTSxlQUFlLENBQUM7QUFDbEYsT0FBTyxFQUFrQixTQUFTLEVBQXFELE1BQU0sMEJBQTBCLENBQUM7QUFFeEgsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQzs7OztNQUV6QixZQUFZLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFOztNQUN6RSxRQUFRLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBRTs7OztBQUUzRCxxQ0FHQzs7O0lBRkcsb0NBQXVCOztJQUN2QixtREFBbUQ7Ozs7O0FBR3ZELHFDQWNDOzs7SUFiRyxnQ0FBZTs7SUFDZixvQ0FVUTs7SUFDUixtQ0FBbUU7O0FBTXZFLE1BQU0sT0FBTyx3QkFBd0I7Ozs7Ozs7SUFDakMsWUFDWSxNQUFpQixFQUNqQixNQUFjLEVBR2QsZUFBaUMsRUFHakMsZUFBaUM7UUFQakMsV0FBTSxHQUFOLE1BQU0sQ0FBVztRQUNqQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBR2Qsb0JBQWUsR0FBZixlQUFlLENBQWtCO1FBR2pDLG9CQUFlLEdBQWYsZUFBZSxDQUFrQjtJQUMxQyxDQUFDOzs7Ozs7O0lBRUosSUFBSSxDQUNBLHNCQUF5RCxFQUN6RCxNQUF3Qjs7Y0FFbEIsR0FBRyxHQUNMLE1BQU0s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QUFpQjs7Ozs7Ozs7SUFOekIsMENBQXlCOzs7OztJQUN6QiwwQ0FBc0I7Ozs7O0lBQ3RCLG1EQUV5Qzs7Ozs7SUFDekMsbURBRXlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBOZ1pvbmUsIE9wdGlvbmFsLCBUZW1wbGF0ZVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEaWFsb2dQb3NpdGlvbiwgTWF0RGlhbG9nLCBNYXREaWFsb2dDb25maWcgYXMgX01hdERpYWxvZ0NvbmZpZywgTWF0RGlhbG9nUmVmIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcclxuaW1wb3J0IHsgQ29tcG9uZW50VHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wb3J0YWwnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcblxyXG5jb25zdCBkaXJhY3Rpb25NYXAgPSB7IGxlZnQ6ICdsZWZ0JywgcmlnaHQ6ICdsZWZ0JywgdG9wOiAndG9wJywgYm90dG9tOiAndG9wJyB9O1xyXG5jb25zdCBtdWx0eU1hcCA9IHsgbGVmdDogMSwgcmlnaHQ6IC0xLCB0b3A6IDEsIGJvdHRvbTogLTEgfTtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQW5pbWF0aW9uT3B0aW9uIHtcclxuICAgIGtleWZyYW1lcz86IEtleWZyYW1lW107XHJcbiAgICBrZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnM6IEtleWZyYW1lQW5pbWF0aW9uT3B0aW9ucztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBNYXREaWFsb2dDb25maWcgZXh0ZW5kcyBfTWF0RGlhbG9nQ29uZmlnIHtcclxuICAgIHRpdGxlPzogc3RyaW5nO1xyXG4gICAgYW5pbWF0aW9uPzpcclxuICAgICAgICB8IHtcclxuICAgICAgICAgICAgICB0bzogJ2FzaWRlJyB8ICd0b3AnIHwgJ2JvdHRvbScgfCAnbGVmdCcgfCAncmlnaHQnO1xyXG4gICAgICAgICAgICAgIGluY29taW5nT3B0aW9ucz86IHsga2V5ZnJhbWVzPzogS2V5ZnJhbWVbXTsga2V5ZnJhbWVBbmltYXRpb25PcHRpb25zOiBLZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnMgfTtcclxuICAgICAgICAgICAgICBvdXRnb2luZ09wdGlvbnM/OiB7IGtleWZyYW1lcz86IEtleWZyYW1lW107IGtleWZyYW1lQW5pbWF0aW9uT3B0aW9uczogS2V5ZnJhbWVBbmltYXRpb25PcHRpb25zIH07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfCB7XHJcbiAgICAgICAgICAgICAgdG8/OiAnYXNpZGUnIHwgJ3RvcCcgfCAnYm90dG9tJyB8ICdsZWZ0JyB8ICdyaWdodCc7XHJcbiAgICAgICAgICAgICAgaW5jb21pbmdPcHRpb25zPzogeyBrZXlmcmFtZXM6IEtleWZyYW1lW107IGtleWZyYW1lQW5pbWF0aW9uT3B0aW9uczogS2V5ZnJhbWVBbmltYXRpb25PcHRpb25zIH07XHJcbiAgICAgICAgICAgICAgb3V0Z29pbmdPcHRpb25zPzogeyBrZXlmcmFtZXM6IEtleWZyYW1lW107IGtleWZyYW1lQW5pbWF0aW9uT3B0aW9uczogS2V5ZnJhbWVBbmltYXRpb25PcHRpb25zIH07XHJcbiAgICAgICAgICB9O1xyXG4gICAgcG9zaXRpb24/OiBEaWFsb2dQb3NpdGlvbiAmIHsgcm93U3RhcnQ/OiBzdHJpbmc7IHJvd0VuZD86IHN0cmluZyB9O1xyXG59XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgICBwcm92aWRlZEluOiAncm9vdCcsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBOZ0RpYWxvZ0FuaW1hdGlvblNlcnZpY2Uge1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBkaWFsb2c6IE1hdERpYWxvZyxcclxuICAgICAgICBwcml2YXRlIG5nWm9uZTogTmdab25lLFxyXG4gICAgICAgIEBPcHRpb25hbCgpXHJcbiAgICAgICAgQEluamVjdCgnSU5DT01JTkdfT1BUSU9OJylcclxuICAgICAgICBwcml2YXRlIGluY29taW5nT3B0aW9ucz86IEFuaW1hdGlvbk9wdGlvbixcclxuICAgICAgICBAT3B0aW9uYWwoKVxyXG4gICAgICAgIEBJbmplY3QoJ09VVEdPSU5HX09QVElPTicpXHJcbiAgICAgICAgcHJpdmF0ZSBvdXRnb2luZ09wdGlvbnM/OiBBbmltYXRpb25PcHRpb24sXHJcbiAgICApIHt9XHJcblxyXG4gICAgb3BlbjxULCBEID0gYW55LCBSID0gYW55PihcclxuICAgICAgICBjb21wb25lbnRPclRlbXBsYXRlUmVmOiBDb21wb25lbnRUeXBlPFQ+IHwgVGVtcGxhdGVSZWY8VD4sXHJcbiAgICAgICAgY29uZmlnPzogTWF0RGlhbG9nQ29uZmlnLFxyXG4gICAgKTogTWF0RGlhbG9nUmVmPFQsIFI+IHtcclxuICAgICAgICBjb25zdCBkaXI6ICdsdHInIHwgJ3J0bCcgPVxyXG4gICAgICAgICAgICBjb25maWcuZGlyZWN0aW9uIHx8IChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGlyPVwicnRsXCJdJykubGVuZ3RoID8gJ3J0bCcgOiAnbHRyJyk7XHJcbiAgICAgICAgY29uZmlnLmRpcmVjdGlvbiA9IGNvbmZpZy5kaXJlY3Rpb24gfHwgZGlyO1xyXG4gICAgICAgIGlmIChjb25maWcuYW5pbWF0aW9uKSB7XHJcbiAgICAgICAgICAgIGlmIChjb25maWcuYW5pbWF0aW9uLnRvID09PSAnYXNpZGUnKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuYW5pbWF0aW9uLnRvID0gZGlyID09PSAncnRsJyA/ICdsZWZ0JyA6ICdyaWdodCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjb25maWcucG9zaXRpb24gJiYgY29uZmlnLnBvc2l0aW9uLnJvd0VuZCkge1xyXG4gICAgICAgICAgaWYgKGRpciA9PT0gJ3J0bCcpIHtcclxuICAgICAgICAgICAgY29uZmlnLnBvc2l0aW9uLnJpZ2h0ID0gY29uZmlnLnBvc2l0aW9uLnJvd0VuZDtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbmZpZy5wb3NpdGlvbi5sZWZ0ID0gY29uZmlnLnBvc2l0aW9uLnJvd0VuZDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjb25maWcucG9zaXRpb24gJiYgY29uZmlnLnBvc2l0aW9uLnJvd1N0YXJ0KSB7XHJcbiAgICAgICAgICBpZiAoZGlyID09PSAncnRsJykge1xyXG4gICAgICAgICAgICBjb25maWcucG9zaXRpb24ubGVmdCA9IGNvbmZpZy5wb3NpdGlvbi5yb3dTdGFydDtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbmZpZy5wb3NpdGlvbi5yaWdodCA9IGNvbmZpZy5wb3NpdGlvbi5yb3dTdGFydDtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHJlZiA9IHRoaXMuZGlhbG9nLm9wZW4oY29tcG9uZW50T3JUZW1wbGF0ZVJlZiwgY29uZmlnKTtcclxuICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnbWF0LWRpYWxvZy1jb250YWluZXInKVswXSBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICBpZiAoY29uZmlnLnRpdGxlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgICAgICBlbC50ZXh0Q29udGVudCA9IGNvbmZpZy50aXRsZTtcclxuICAgICAgICAgICAgZWwuY2xhc3NOYW1lID0gJ2RpYWxvZ1RpdGxlJztcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGVsQ2xvc2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgICAgIGVsQ2xvc2UudGV4dENvbnRlbnQgPSAnWCc7XHJcbiAgICAgICAgICAgIGVsQ2xvc2UuY2xhc3NOYW1lID0gJ2RpYWxvZ0Nsb3NlJztcclxuICAgICAgICAgICAgZWxDbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlZi5jbG9zZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIHRpdGxlQ29udGFpbmVyLmNsYXNzTmFtZSA9ICd0aXRsZUNvbnRhaW5lcic7XHJcbiAgICAgICAgICAgIHRpdGxlQ29udGFpbmVyLmFwcGVuZChlbCk7XHJcbiAgICAgICAgICAgIHRpdGxlQ29udGFpbmVyLmFwcGVuZChlbENsb3NlKTtcclxuICAgICAgICAgICAgY29udGFpbmVyLnByZXBlbmQodGl0bGVDb250YWluZXIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNvbmZpZy5hbmltYXRpb24pIHtcclxuICAgICAgICAgICAgY29uc3QgaW5jb21pbmdPcHRpb25zOiBBbmltYXRpb25PcHRpb24gPSBjb25maWcuYW5pbWF0aW9uLmluY29taW5nT3B0aW9ucyB8fFxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbmNvbWluZ09wdGlvbnMgfHwgeyBrZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnM6IHsgZHVyYXRpb246IDYwMCwgZWFzaW5nOiAnZWFzZS1pbicgfSB9O1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgb3V0Z29pbmdPcHRpb25zOiBBbmltYXRpb25PcHRpb24gPSBjb25maWcuYW5pbWF0aW9uLm91dGdvaW5nT3B0aW9ucyB8fFxyXG4gICAgICAgICAgICAgICAgdGhpcy5vdXRnb2luZ09wdGlvbnMgfHwgeyBrZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnM6IHsgZHVyYXRpb246IDYwMCwgZWFzaW5nOiAnZWFzZS1vdXQnIH0gfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjZGstZ2xvYmFsLW92ZXJsYXktd3JhcHBlcicpWzBdO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgYW5pbWF0ZSA9IChrZXlmcmFtZXMsIG9wdGlvbnMpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB3cmFwcGVyLmFuaW1hdGUoa2V5ZnJhbWVzLCBvcHRpb25zKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY29uc3QgX2FmdGVyQ2xvc2VkID0gbmV3IFN1YmplY3QoKTtcclxuICAgICAgICAgICAgcmVmLmFmdGVyQ2xvc2VkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9hZnRlckNsb3NlZC5hc09ic2VydmFibGUoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY29uc3QgY2xvc2VGdW5jdGlvbiA9IHJlZi5jbG9zZTtcclxuXHJcbiAgICAgICAgICAgIGxldCBpbmNvbWVLZXlGcmFtZXMgPSBpbmNvbWluZ09wdGlvbnMua2V5ZnJhbWVzO1xyXG4gICAgICAgICAgICBsZXQgb3V0Z29pbmdLZXlGcmFtZXMgPSBvdXRnb2luZ09wdGlvbnMua2V5ZnJhbWVzO1xyXG4gICAgICAgICAgICBpZiAoY29uZmlnLmFuaW1hdGlvbi50bykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdG8gPSBkaXJhY3Rpb25NYXBbY29uZmlnLmFuaW1hdGlvbi50b107XHJcbiAgICAgICAgICAgICAgICBjb25zdCBrZXlGcmFtZTEwMCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgY29uc3Qga2V5RnJhbWUwID0ge307XHJcbiAgICAgICAgICAgICAgICBrZXlGcmFtZTBbdG9dID0gMDtcclxuICAgICAgICAgICAgICAgIGtleUZyYW1lMTAwW3RvXSA9XHJcbiAgICAgICAgICAgICAgICAgICAgdG8gPT09ICd0b3AnIHx8IHRvID09PSAnYm90dG9tJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGNvbnRhaW5lci5jbGllbnRIZWlnaHQgKiBtdWx0eU1hcFtjb25maWcuYW5pbWF0aW9uLnRvXSArICdweCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgOiBjb250YWluZXIuY2xpZW50V2lkdGggKiBtdWx0eU1hcFtjb25maWcuYW5pbWF0aW9uLnRvXSArICdweCc7XHJcbiAgICAgICAgICAgICAgICBpbmNvbWVLZXlGcmFtZXMgPSBpbmNvbWVLZXlGcmFtZXMgfHwgW2tleUZyYW1lMTAwLCBrZXlGcmFtZTBdO1xyXG4gICAgICAgICAgICAgICAgb3V0Z29pbmdLZXlGcmFtZXMgPSBvdXRnb2luZ0tleUZyYW1lcyB8fCBba2V5RnJhbWUwLCBrZXlGcmFtZTEwMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYW5pbWF0ZShpbmNvbWVLZXlGcmFtZXMsIGluY29taW5nT3B0aW9ucy5rZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnMpO1xyXG4gICAgICAgICAgICBjb25zdCBjbG9zZUhhbmRsZXIgPSAoZGlhbG9nUmVzdWx0PzogUikgPT4ge1xyXG4gICAgICAgICAgICAgICAgX2FmdGVyQ2xvc2VkLm5leHQoZGlhbG9nUmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFuaW1hdGlvbiA9IGFuaW1hdGUob3V0Z29pbmdLZXlGcmFtZXMsIG91dGdvaW5nT3B0aW9ucy5rZXlmcmFtZUFuaW1hdGlvbk9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uLm9uZmluaXNoID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICh3cmFwcGVyIGFzIEhUTUxFbGVtZW50KS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiByZWYuY2xvc2UoZGlhbG9nUmVzdWx0KSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgcmVmLmNsb3NlID0gY2xvc2VGdW5jdGlvbjtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmVmLmNsb3NlID0gKGRpYWxvZ1Jlc3VsdD86IFIpID0+IGNsb3NlSGFuZGxlcihkaWFsb2dSZXN1bHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlZjtcclxuICAgIH1cclxufVxyXG4iXX0=