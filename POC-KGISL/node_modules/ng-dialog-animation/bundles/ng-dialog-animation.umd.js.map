{"version":3,"file":"ng-dialog-animation.umd.js","sources":["ng://ng-dialog-animation/lib/ng-dialog-animation.service.ts"],"sourcesContent":["import { Inject, Injectable, NgZone, Optional, TemplateRef } from '@angular/core';\r\nimport { DialogPosition, MatDialog, MatDialogConfig as _MatDialogConfig, MatDialogRef } from '@angular/material/dialog';\r\nimport { ComponentType } from '@angular/cdk/portal';\r\nimport { Subject } from 'rxjs';\r\n\r\nconst diractionMap = { left: 'left', right: 'left', top: 'top', bottom: 'top' };\r\nconst multyMap = { left: 1, right: -1, top: 1, bottom: -1 };\r\n\r\nexport interface AnimationOption {\r\n    keyframes?: Keyframe[];\r\n    keyframeAnimationOptions: KeyframeAnimationOptions;\r\n}\r\n\r\nexport interface MatDialogConfig extends _MatDialogConfig {\r\n    title?: string;\r\n    animation?:\r\n        | {\r\n              to: 'aside' | 'top' | 'bottom' | 'left' | 'right';\r\n              incomingOptions?: { keyframes?: Keyframe[]; keyframeAnimationOptions: KeyframeAnimationOptions };\r\n              outgoingOptions?: { keyframes?: Keyframe[]; keyframeAnimationOptions: KeyframeAnimationOptions };\r\n          }\r\n        | {\r\n              to?: 'aside' | 'top' | 'bottom' | 'left' | 'right';\r\n              incomingOptions?: { keyframes: Keyframe[]; keyframeAnimationOptions: KeyframeAnimationOptions };\r\n              outgoingOptions?: { keyframes: Keyframe[]; keyframeAnimationOptions: KeyframeAnimationOptions };\r\n          };\r\n    position?: DialogPosition & { rowStart?: string; rowEnd?: string };\r\n}\r\n\r\n@Injectable({\r\n    providedIn: 'root',\r\n})\r\nexport class NgDialogAnimationService {\r\n    constructor(\r\n        private dialog: MatDialog,\r\n        private ngZone: NgZone,\r\n        @Optional()\r\n        @Inject('INCOMING_OPTION')\r\n        private incomingOptions?: AnimationOption,\r\n        @Optional()\r\n        @Inject('OUTGOING_OPTION')\r\n        private outgoingOptions?: AnimationOption,\r\n    ) {}\r\n\r\n    open<T, D = any, R = any>(\r\n        componentOrTemplateRef: ComponentType<T> | TemplateRef<T>,\r\n        config?: MatDialogConfig,\r\n    ): MatDialogRef<T, R> {\r\n        const dir: 'ltr' | 'rtl' =\r\n            config.direction || (document.querySelectorAll('[dir=\"rtl\"]').length ? 'rtl' : 'ltr');\r\n        config.direction = config.direction || dir;\r\n        if (config.animation) {\r\n            if (config.animation.to === 'aside') {\r\n                config.animation.to = dir === 'rtl' ? 'left' : 'right';\r\n            }\r\n        }\r\n\r\n        if (config.position && config.position.rowEnd) {\r\n          if (dir === 'rtl') {\r\n            config.position.right = config.position.rowEnd;\r\n          } else {\r\n            config.position.left = config.position.rowEnd;\r\n          }\r\n        }\r\n\r\n        if (config.position && config.position.rowStart) {\r\n          if (dir === 'rtl') {\r\n            config.position.left = config.position.rowStart;\r\n          } else {\r\n            config.position.right = config.position.rowStart;\r\n          }\r\n        }\r\n\r\n        const ref = this.dialog.open(componentOrTemplateRef, config);\r\n        const container = document.getElementsByTagName('mat-dialog-container')[0] as HTMLElement;\r\n        if (config.title) {\r\n            const el = document.createElement('span');\r\n            el.textContent = config.title;\r\n            el.className = 'dialogTitle';\r\n\r\n            const elClose = document.createElement('span');\r\n            elClose.textContent = 'X';\r\n            elClose.className = 'dialogClose';\r\n            elClose.addEventListener('click', () => {\r\n                ref.close();\r\n            });\r\n\r\n            const titleContainer = document.createElement('div');\r\n            titleContainer.className = 'titleContainer';\r\n            titleContainer.append(el);\r\n            titleContainer.append(elClose);\r\n            container.prepend(titleContainer);\r\n        }\r\n\r\n        if (config.animation) {\r\n            const incomingOptions: AnimationOption = config.animation.incomingOptions ||\r\n                this.incomingOptions || { keyframeAnimationOptions: { duration: 600, easing: 'ease-in' } };\r\n\r\n            const outgoingOptions: AnimationOption = config.animation.outgoingOptions ||\r\n                this.outgoingOptions || { keyframeAnimationOptions: { duration: 600, easing: 'ease-out' } };\r\n\r\n            const wrapper = document.getElementsByClassName('cdk-global-overlay-wrapper')[0];\r\n\r\n            const animate = (keyframes, options) => {\r\n                return wrapper.animate(keyframes, options);\r\n            };\r\n            const _afterClosed = new Subject();\r\n            ref.afterClosed = () => {\r\n                return _afterClosed.asObservable();\r\n            };\r\n            const closeFunction = ref.close;\r\n\r\n            let incomeKeyFrames = incomingOptions.keyframes;\r\n            let outgoingKeyFrames = outgoingOptions.keyframes;\r\n            if (config.animation.to) {\r\n                const to = diractionMap[config.animation.to];\r\n                const keyFrame100 = {};\r\n                const keyFrame0 = {};\r\n                keyFrame0[to] = 0;\r\n                keyFrame100[to] =\r\n                    to === 'top' || to === 'bottom'\r\n                        ? container.clientHeight * multyMap[config.animation.to] + 'px'\r\n                        : container.clientWidth * multyMap[config.animation.to] + 'px';\r\n                incomeKeyFrames = incomeKeyFrames || [keyFrame100, keyFrame0];\r\n                outgoingKeyFrames = outgoingKeyFrames || [keyFrame0, keyFrame100];\r\n            }\r\n            animate(incomeKeyFrames, incomingOptions.keyframeAnimationOptions);\r\n            const closeHandler = (dialogResult?: R) => {\r\n                _afterClosed.next(dialogResult);\r\n                const animation = animate(outgoingKeyFrames, outgoingOptions.keyframeAnimationOptions);\r\n                animation.onfinish = () => {\r\n                    (wrapper as HTMLElement).style.display = 'none';\r\n                    this.ngZone.run(() => ref.close(dialogResult));\r\n                };\r\n                ref.close = closeFunction;\r\n            };\r\n            ref.close = (dialogResult?: R) => closeHandler(dialogResult);\r\n        }\r\n\r\n        return ref;\r\n    }\r\n}\r\n"],"names":["Subject","Injectable","MatDialog","NgZone","Optional","Inject"],"mappings":"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"}