{"version":3,"file":"ng-dialog-animation.js","sources":["ng://ng-dialog-animation/lib/ng-dialog-animation.service.ts"],"sourcesContent":["import { Inject, Injectable, NgZone, Optional, TemplateRef } from '@angular/core';\r\nimport { DialogPosition, MatDialog, MatDialogConfig as _MatDialogConfig, MatDialogRef } from '@angular/material/dialog';\r\nimport { ComponentType } from '@angular/cdk/portal';\r\nimport { Subject } from 'rxjs';\r\n\r\nconst diractionMap = { left: 'left', right: 'left', top: 'top', bottom: 'top' };\r\nconst multyMap = { left: 1, right: -1, top: 1, bottom: -1 };\r\n\r\nexport interface AnimationOption {\r\n    keyframes?: Keyframe[];\r\n    keyframeAnimationOptions: KeyframeAnimationOptions;\r\n}\r\n\r\nexport interface MatDialogConfig extends _MatDialogConfig {\r\n    title?: string;\r\n    animation?:\r\n        | {\r\n              to: 'aside' | 'top' | 'bottom' | 'left' | 'right';\r\n              incomingOptions?: { keyframes?: Keyframe[]; keyframeAnimationOptions: KeyframeAnimationOptions };\r\n              outgoingOptions?: { keyframes?: Keyframe[]; keyframeAnimationOptions: KeyframeAnimationOptions };\r\n          }\r\n        | {\r\n              to?: 'aside' | 'top' | 'bottom' | 'left' | 'right';\r\n              incomingOptions?: { keyframes: Keyframe[]; keyframeAnimationOptions: KeyframeAnimationOptions };\r\n              outgoingOptions?: { keyframes: Keyframe[]; keyframeAnimationOptions: KeyframeAnimationOptions };\r\n          };\r\n    position?: DialogPosition & { rowStart?: string; rowEnd?: string };\r\n}\r\n\r\n@Injectable({\r\n    providedIn: 'root',\r\n})\r\nexport class NgDialogAnimationService {\r\n    constructor(\r\n        private dialog: MatDialog,\r\n        private ngZone: NgZone,\r\n        @Optional()\r\n        @Inject('INCOMING_OPTION')\r\n        private incomingOptions?: AnimationOption,\r\n        @Optional()\r\n        @Inject('OUTGOING_OPTION')\r\n        private outgoingOptions?: AnimationOption,\r\n    ) {}\r\n\r\n    open<T, D = any, R = any>(\r\n        componentOrTemplateRef: ComponentType<T> | TemplateRef<T>,\r\n        config?: MatDialogConfig,\r\n    ): MatDialogRef<T, R> {\r\n        const dir: 'ltr' | 'rtl' =\r\n            config.direction || (document.querySelectorAll('[dir=\"rtl\"]').length ? 'rtl' : 'ltr');\r\n        config.direction = config.direction || dir;\r\n        if (config.animation) {\r\n            if (config.animation.to === 'aside') {\r\n                config.animation.to = dir === 'rtl' ? 'left' : 'right';\r\n            }\r\n        }\r\n\r\n        if (config.position && config.position.rowEnd) {\r\n          if (dir === 'rtl') {\r\n            config.position.right = config.position.rowEnd;\r\n          } else {\r\n            config.position.left = config.position.rowEnd;\r\n          }\r\n        }\r\n\r\n        if (config.position && config.position.rowStart) {\r\n          if (dir === 'rtl') {\r\n            config.position.left = config.position.rowStart;\r\n          } else {\r\n            config.position.right = config.position.rowStart;\r\n          }\r\n        }\r\n\r\n        const ref = this.dialog.open(componentOrTemplateRef, config);\r\n        const container = document.getElementsByTagName('mat-dialog-container')[0] as HTMLElement;\r\n        if (config.title) {\r\n            const el = document.createElement('span');\r\n            el.textContent = config.title;\r\n            el.className = 'dialogTitle';\r\n\r\n            const elClose = document.createElement('span');\r\n            elClose.textContent = 'X';\r\n            elClose.className = 'dialogClose';\r\n            elClose.addEventListener('click', () => {\r\n                ref.close();\r\n            });\r\n\r\n            const titleContainer = document.createElement('div');\r\n            titleContainer.className = 'titleContainer';\r\n            titleContainer.append(el);\r\n            titleContainer.append(elClose);\r\n            container.prepend(titleContainer);\r\n        }\r\n\r\n        if (config.animation) {\r\n            const incomingOptions: AnimationOption = config.animation.incomingOptions ||\r\n                this.incomingOptions || { keyframeAnimationOptions: { duration: 600, easing: 'ease-in' } };\r\n\r\n            const outgoingOptions: AnimationOption = config.animation.outgoingOptions ||\r\n                this.outgoingOptions || { keyframeAnimationOptions: { duration: 600, easing: 'ease-out' } };\r\n\r\n            const wrapper = document.getElementsByClassName('cdk-global-overlay-wrapper')[0];\r\n\r\n            const animate = (keyframes, options) => {\r\n                return wrapper.animate(keyframes, options);\r\n            };\r\n            const _afterClosed = new Subject();\r\n            ref.afterClosed = () => {\r\n                return _afterClosed.asObservable();\r\n            };\r\n            const closeFunction = ref.close;\r\n\r\n            let incomeKeyFrames = incomingOptions.keyframes;\r\n            let outgoingKeyFrames = outgoingOptions.keyframes;\r\n            if (config.animation.to) {\r\n                const to = diractionMap[config.animation.to];\r\n                const keyFrame100 = {};\r\n                const keyFrame0 = {};\r\n                keyFrame0[to] = 0;\r\n                keyFrame100[to] =\r\n                    to === 'top' || to === 'bottom'\r\n                        ? container.clientHeight * multyMap[config.animation.to] + 'px'\r\n                        : container.clientWidth * multyMap[config.animation.to] + 'px';\r\n                incomeKeyFrames = incomeKeyFrames || [keyFrame100, keyFrame0];\r\n                outgoingKeyFrames = outgoingKeyFrames || [keyFrame0, keyFrame100];\r\n            }\r\n            animate(incomeKeyFrames, incomingOptions.keyframeAnimationOptions);\r\n            const closeHandler = (dialogResult?: R) => {\r\n                _afterClosed.next(dialogResult);\r\n                const animation = animate(outgoingKeyFrames, outgoingOptions.keyframeAnimationOptions);\r\n                animation.onfinish = () => {\r\n                    (wrapper as HTMLElement).style.display = 'none';\r\n                    this.ngZone.run(() => ref.close(dialogResult));\r\n                };\r\n                ref.close = closeFunction;\r\n            };\r\n            ref.close = (dialogResult?: R) => closeHandler(dialogResult);\r\n        }\r\n\r\n        return ref;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}